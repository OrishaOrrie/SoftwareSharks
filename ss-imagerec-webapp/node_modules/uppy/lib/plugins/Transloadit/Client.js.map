{"version":3,"sources":["../../../src/plugins/Transloadit/Client.js"],"names":["module","exports","opts","createAssembly","templateId","params","fields","signature","expectedFiles","data","FormData","append","JSON","stringify","Object","keys","forEach","key","fetch","service","method","body","then","response","json","assembly","error","Error","message","code","status","reserveFile","file","size","encodeURIComponent","assembly_ssl_url","addFile","uploadURL","reject","url","filename","name","fieldname","qs","getAssemblyStatus"],"mappings":";;;;AAAA;;;AAGAA,OAAOC,OAAP;AACE,oBAAwB;AAAA,QAAXC,IAAW,uEAAJ,EAAI;;AAAA;;AACtB,SAAKA,IAAL,GAAYA,IAAZ;AACD;;AAED;;;;;;;AALF,mBAUEC,cAVF,iCAgBK;AAAA,QALDC,UAKC,QALDA,UAKC;AAAA,QAJDC,MAIC,QAJDA,MAIC;AAAA,QAHDC,MAGC,QAHDA,MAGC;AAAA,QAFDC,SAEC,QAFDA,SAEC;AAAA,QADDC,aACC,QADDA,aACC;;AACD,QAAMC,OAAO,IAAIC,QAAJ,EAAb;AACAD,SAAKE,MAAL,CAAY,QAAZ,EAAsB,OAAON,MAAP,KAAkB,QAAlB,GAClBA,MADkB,GAElBO,KAAKC,SAAL,CAAeR,MAAf,CAFJ;AAGA,QAAIE,SAAJ,EAAe;AACbE,WAAKE,MAAL,CAAY,WAAZ,EAAyBJ,SAAzB;AACD;;AAEDO,WAAOC,IAAP,CAAYT,MAAZ,EAAoBU,OAApB,CAA4B,UAACC,GAAD,EAAS;AACnCR,WAAKE,MAAL,CAAYM,GAAZ,EAAiBX,OAAOW,GAAP,CAAjB;AACD,KAFD;AAGAR,SAAKE,MAAL,CAAY,2BAAZ,EAAyCH,aAAzC;;AAEA,WAAOU,MAAS,KAAKhB,IAAL,CAAUiB,OAAnB,kBAAyC;AAC9CC,cAAQ,MADsC;AAE9CC,YAAMZ;AAFwC,KAAzC,EAGJa,IAHI,CAGC,UAACC,QAAD;AAAA,aAAcA,SAASC,IAAT,EAAd;AAAA,KAHD,EAGgCF,IAHhC,CAGqC,UAACG,QAAD,EAAc;AACxD,UAAIA,SAASC,KAAb,EAAoB;AAClB,YAAMA,QAAQ,IAAIC,KAAJ,CAAUF,SAASG,OAAnB,CAAd;AACAF,cAAMG,IAAN,GAAaJ,SAASC,KAAtB;AACAA,cAAMI,MAAN,GAAeL,QAAf;AACA,cAAMC,KAAN;AACD;;AAED,aAAOD,QAAP;AACD,KAZM,CAAP;AAaD,GA3CH;;AAAA,mBA6CEM,WA7CF,wBA6CeN,QA7Cf,EA6CyBO,IA7CzB,EA6C+B;AAC3B,QAAMC,OAAOC,mBAAmBF,KAAKC,IAAxB,CAAb;AACA,WAAOf,MAASO,SAASU,gBAAlB,2BAAwDF,IAAxD,EAAgE,EAAEb,QAAQ,MAAV,EAAhE,EACJE,IADI,CACC,UAACC,QAAD;AAAA,aAAcA,SAASC,IAAT,EAAd;AAAA,KADD,CAAP;AAED,GAjDH;;AAAA,mBAmDEY,OAnDF,oBAmDWX,QAnDX,EAmDqBO,IAnDrB,EAmD2B;AACvB,QAAI,CAACA,KAAKK,SAAV,EAAqB;AACnB,aAAO,SAAQC,MAAR,CAAe,IAAIX,KAAJ,CAAU,oCAAV,CAAf,CAAP;AACD;AACD,QAAMM,OAAOC,mBAAmBF,KAAKC,IAAxB,CAAb;AACA,QAAMM,MAAML,mBAAmBF,KAAKK,SAAxB,CAAZ;AACA,QAAMG,WAAWN,mBAAmBF,KAAKS,IAAxB,CAAjB;AACA,QAAMC,YAAY,MAAlB;;AAEA,QAAMC,eAAaV,IAAb,kBAA8BO,QAA9B,mBAAoDE,SAApD,eAAuEH,GAA7E;AACA,WAAOrB,MAASO,SAASU,gBAAlB,kBAA+CQ,EAA/C,EAAqD,EAAEvB,QAAQ,MAAV,EAArD,EACJE,IADI,CACC,UAACC,QAAD;AAAA,aAAcA,SAASC,IAAT,EAAd;AAAA,KADD,CAAP;AAED,GA/DH;;AAiEE;;;;;;;AAjEF,mBAsEEoB,iBAtEF,8BAsEqBL,GAtErB,EAsE0B;AACtB,WAAOrB,MAAMqB,GAAN,EACJjB,IADI,CACC,UAACC,QAAD;AAAA,aAAcA,SAASC,IAAT,EAAd;AAAA,KADD,CAAP;AAED,GAzEH;;AAAA;AAAA","file":"Client.js","sourcesContent":["/**\n * A Barebones HTTP API client for Transloadit.\n */\nmodule.exports = class Client {\n  constructor (opts = {}) {\n    this.opts = opts\n  }\n\n  /**\n   * Create a new assembly.\n   *\n   * @param {object} options\n   */\n  createAssembly ({\n    templateId,\n    params,\n    fields,\n    signature,\n    expectedFiles\n  }) {\n    const data = new FormData()\n    data.append('params', typeof params === 'string'\n      ? params\n      : JSON.stringify(params))\n    if (signature) {\n      data.append('signature', signature)\n    }\n\n    Object.keys(fields).forEach((key) => {\n      data.append(key, fields[key])\n    })\n    data.append('num_expected_upload_files', expectedFiles)\n\n    return fetch(`${this.opts.service}/assemblies`, {\n      method: 'post',\n      body: data\n    }).then((response) => response.json()).then((assembly) => {\n      if (assembly.error) {\n        const error = new Error(assembly.message)\n        error.code = assembly.error\n        error.status = assembly\n        throw error\n      }\n\n      return assembly\n    })\n  }\n\n  reserveFile (assembly, file) {\n    const size = encodeURIComponent(file.size)\n    return fetch(`${assembly.assembly_ssl_url}/reserve_file?size=${size}`, { method: 'post' })\n      .then((response) => response.json())\n  }\n\n  addFile (assembly, file) {\n    if (!file.uploadURL) {\n      return Promise.reject(new Error('File does not have an `uploadURL`.'))\n    }\n    const size = encodeURIComponent(file.size)\n    const url = encodeURIComponent(file.uploadURL)\n    const filename = encodeURIComponent(file.name)\n    const fieldname = 'file'\n\n    const qs = `size=${size}&filename=${filename}&fieldname=${fieldname}&s3Url=${url}`\n    return fetch(`${assembly.assembly_ssl_url}/add_file?${qs}`, { method: 'post' })\n      .then((response) => response.json())\n  }\n\n  /**\n   * Get the current status for an assembly.\n   *\n   * @param {string} url The status endpoint of the assembly.\n   */\n  getAssemblyStatus (url) {\n    return fetch(url)\n      .then((response) => response.json())\n  }\n}\n"]}