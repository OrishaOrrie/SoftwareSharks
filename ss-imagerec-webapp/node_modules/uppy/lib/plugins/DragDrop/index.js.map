{"version":3,"sources":["../../../src/plugins/DragDrop/index.js"],"names":["Plugin","require","Translator","toArray","dragDrop","h","module","exports","uppy","opts","type","id","title","defaultLocale","strings","dropHereOr","browse","defaultOpts","target","width","height","note","locale","isDragDropSupported","checkDragDropSupport","translator","i18n","translate","bind","handleDrop","handleBrowseClick","handleInputChange","render","div","document","createElement","window","files","log","forEach","file","addFile","source","name","data","catch","ev","stopPropagation","input","click","state","DragDropClass","DragDropStyle","install","mount","removeDragDropListener","el","uninstall","unmount"],"mappings":"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","file":"index.js","sourcesContent":["const Plugin = require('../../core/Plugin')\nconst Translator = require('../../core/Translator')\nconst { toArray } = require('../../core/Utils')\nconst dragDrop = require('drag-drop')\nconst { h } = require('preact')\n\n/**\n * Drag & Drop plugin\n *\n */\nmodule.exports = class DragDrop extends Plugin {\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    const defaultLocale = {\n      strings: {\n        dropHereOr: 'Drop files here or',\n        browse: 'browse'\n      }\n    }\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n      width: '100%',\n      height: '100%',\n      note: '',\n      locale: defaultLocale\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOpts, opts)\n\n    // Check for browser dragDrop support\n    this.isDragDropSupported = this.checkDragDropSupport()\n\n    this.locale = Object.assign({}, defaultLocale, this.opts.locale)\n    this.locale.strings = Object.assign({}, defaultLocale.strings, this.opts.locale.strings)\n\n    // i18n\n    this.translator = new Translator({locale: this.locale})\n    this.i18n = this.translator.translate.bind(this.translator)\n\n    // Bind `this` to class methods\n    this.handleDrop = this.handleDrop.bind(this)\n    this.handleBrowseClick = this.handleBrowseClick.bind(this)\n    this.handleInputChange = this.handleInputChange.bind(this)\n    this.checkDragDropSupport = this.checkDragDropSupport.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  /**\n   * Checks if the browser supports Drag & Drop (not supported on mobile devices, for example).\n   * @return {Boolean}\n   */\n  checkDragDropSupport () {\n    const div = document.createElement('div')\n\n    if (!('draggable' in div) || !('ondragstart' in div && 'ondrop' in div)) {\n      return false\n    }\n\n    if (!('FormData' in window)) {\n      return false\n    }\n\n    if (!('FileReader' in window)) {\n      return false\n    }\n\n    return true\n  }\n\n  handleDrop (files) {\n    this.uppy.log('[DragDrop] Files dropped')\n\n    files.forEach((file) => {\n      this.uppy.addFile({\n        source: this.id,\n        name: file.name,\n        type: file.type,\n        data: file\n      }).catch(() => {\n        // Ignore\n      })\n    })\n  }\n\n  handleInputChange (ev) {\n    this.uppy.log('[DragDrop] Files selected through input')\n\n    const files = toArray(ev.target.files)\n\n    files.forEach((file) => {\n      this.uppy.addFile({\n        source: this.id,\n        name: file.name,\n        type: file.type,\n        data: file\n      }).catch(() => {\n        // Ignore\n      })\n    })\n  }\n\n  handleBrowseClick (ev) {\n    ev.stopPropagation()\n    this.input.click()\n  }\n\n  render (state) {\n    const DragDropClass = `uppy uppy-DragDrop-container ${this.isDragDropSupported ? 'is-dragdrop-supported' : ''}`\n    const DragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height\n    }\n    return (\n      <div class={DragDropClass} style={DragDropStyle}>\n        <div class=\"uppy-DragDrop-inner\">\n          <svg aria-hidden=\"true\" class=\"UppyIcon uppy-DragDrop-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fill-rule=\"evenodd\" />\n          </svg>\n          <input class=\"uppy-DragDrop-input\"\n            type=\"file\"\n            name=\"files[]\"\n            multiple=\"true\"\n            ref={(input) => {\n              this.input = input\n            }}\n            onchange={this.handleInputChange} />\n          <label class=\"uppy-DragDrop-label\" onclick={this.handleBrowseClick}>\n            {this.i18n('dropHereOr')} <span class=\"uppy-DragDrop-dragText\">{this.i18n('browse')}</span>\n          </label>\n          <span class=\"uppy-DragDrop-note\">{this.opts.note}</span>\n        </div>\n      </div>\n    )\n  }\n\n  install () {\n    const target = this.opts.target\n    if (target) {\n      this.mount(target, this)\n    }\n    this.removeDragDropListener = dragDrop(this.el, (files) => {\n      this.handleDrop(files)\n      this.uppy.log(files)\n    })\n  }\n\n  uninstall () {\n    this.unmount()\n    this.removeDragDropListener()\n  }\n}\n"]}