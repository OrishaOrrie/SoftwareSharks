{"version":3,"sources":["../../../src/plugins/GoldenRetriever/ServiceWorker.js"],"names":["fileCache","Object","create","getCache","name","self","addEventListener","event","console","log","waitUntil","resolve","then","skipWaiting","clients","claim","sendMessageToAllClients","msg","matchAll","forEach","client","postMessage","addFile","store","file","id","data","removeFile","fileID","getFiles","type","files"],"mappings":";;AAAA;;AAEA,IAAMA,YAAYC,OAAOC,MAAP,CAAc,IAAd,CAAlB;;AAEA,SAASC,QAAT,CAAmBC,IAAnB,EAAyB;AACvB,MAAI,CAACJ,UAAUI,IAAV,CAAL,EAAsB;AACpBJ,cAAUI,IAAV,IAAkBH,OAAOC,MAAP,CAAc,IAAd,CAAlB;AACD;AACD,SAAOF,UAAUI,IAAV,CAAP;AACD;;AAEDC,KAAKC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1CC,UAAQC,GAAR,CAAY,mCAAZ;;AAEAF,QAAMG,SAAN,CAAgB,SAAQC,OAAR,GACbC,IADa,CACR;AAAA,WAAMP,KAAKQ,WAAL,EAAN;AAAA,GADQ,CAAhB;AAED,CALD;;AAOAR,KAAKC,gBAAL,CAAsB,UAAtB,EAAkC,UAACC,KAAD,EAAW;AAC3CA,QAAMG,SAAN,CAAgBL,KAAKS,OAAL,CAAaC,KAAb,EAAhB;AACD,CAFD;;AAIA,SAASC,uBAAT,CAAkCC,GAAlC,EAAuC;AACrCH,UAAQI,QAAR,GAAmBN,IAAnB,CAAwB,UAACE,OAAD,EAAa;AACnCA,YAAQK,OAAR,CAAgB,UAACC,MAAD,EAAY;AAC1BA,aAAOC,WAAP,CAAmBJ,GAAnB;AACD,KAFD;AAGD,GAJD;AAKD;;AAED,SAASK,OAAT,CAAkBC,KAAlB,EAAyBC,IAAzB,EAA+B;AAC7BrB,WAASoB,KAAT,EAAgBC,KAAKC,EAArB,IAA2BD,KAAKE,IAAhC;AACAlB,UAAQC,GAAR,CAAY,0CAAZ,EAAwDe,KAAKE,IAA7D;AACD;;AAED,SAASC,UAAT,CAAqBJ,KAArB,EAA4BK,MAA5B,EAAoC;AAClC,SAAOzB,SAASoB,KAAT,EAAgBK,MAAhB,CAAP;AACApB,UAAQC,GAAR,CAAY,8CAAZ,EAA4DmB,MAA5D;AACD;;AAED,SAASC,QAAT,CAAmBN,KAAnB,EAA0B;AACxBP,0BAAwB;AACtBc,UAAM,gBADgB;AAEtBP,WAAOA,KAFe;AAGtBQ,WAAO5B,SAASoB,KAAT;AAHe,GAAxB;AAKD;;AAEDlB,KAAKC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1C,UAAQA,MAAMmB,IAAN,CAAWI,IAAnB;AACE,SAAK,eAAL;AACER,cAAQf,MAAMmB,IAAN,CAAWH,KAAnB,EAA0BhB,MAAMmB,IAAN,CAAWF,IAArC;AACA;AACF,SAAK,kBAAL;AACEG,iBAAWpB,MAAMmB,IAAN,CAAWH,KAAtB,EAA6BhB,MAAMmB,IAAN,CAAWE,MAAxC;AACA;AACF,SAAK,gBAAL;AACEC,eAAStB,MAAMmB,IAAN,CAAWH,KAApB;AACA;AATJ;AAWD,CAZD","file":"ServiceWorker.js","sourcesContent":["/* globals clients */\n\nconst fileCache = Object.create(null)\n\nfunction getCache (name) {\n  if (!fileCache[name]) {\n    fileCache[name] = Object.create(null)\n  }\n  return fileCache[name]\n}\n\nself.addEventListener('install', (event) => {\n  console.log('Installing Uppy Service Worker...')\n\n  event.waitUntil(Promise.resolve()\n    .then(() => self.skipWaiting()))\n})\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(self.clients.claim())\n})\n\nfunction sendMessageToAllClients (msg) {\n  clients.matchAll().then((clients) => {\n    clients.forEach((client) => {\n      client.postMessage(msg)\n    })\n  })\n}\n\nfunction addFile (store, file) {\n  getCache(store)[file.id] = file.data\n  console.log('Added file blob to service worker cache:', file.data)\n}\n\nfunction removeFile (store, fileID) {\n  delete getCache(store)[fileID]\n  console.log('Removed file blob from service worker cache:', fileID)\n}\n\nfunction getFiles (store) {\n  sendMessageToAllClients({\n    type: 'uppy/ALL_FILES',\n    store: store,\n    files: getCache(store)\n  })\n}\n\nself.addEventListener('message', (event) => {\n  switch (event.data.type) {\n    case 'uppy/ADD_FILE':\n      addFile(event.data.store, event.data.file)\n      break\n    case 'uppy/REMOVE_FILE':\n      removeFile(event.data.store, event.data.fileID)\n      break\n    case 'uppy/GET_FILES':\n      getFiles(event.data.store)\n      break\n  }\n})\n"]}