{"version":3,"sources":["../../src/plugins/Form.js"],"names":["Plugin","require","findDOMElement","getFormData","default","module","exports","uppy","opts","type","id","title","defaultOptions","target","resultName","getMetaFromForm","addResultToForm","submitOnSuccess","triggerUploadOnSubmit","handleFormSubmit","bind","handleUploadStart","handleSuccess","result","form","submit","ev","preventDefault","upload","log","resultInput","querySelector","value","JSON","stringify","document","createElement","name","appendChild","formMeta","setMeta","install","nodeName","console","error","addEventListener","on","uninstall","removeEventListener","off"],"mappings":"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","file":"Form.js","sourcesContent":["const Plugin = require('../core/Plugin')\nconst { findDOMElement } = require('../core/Utils')\n// Rollup uses get-form-data's ES modules build, and rollup-plugin-commonjs automatically resolves `.default`.\n// So, if we are being built using rollup, this require() won't have a `.default` property.\nconst getFormData = require('get-form-data').default || require('get-form-data')\n\n/**\n * Form\n */\nmodule.exports = class Form extends Plugin {\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = 'Form'\n    this.title = 'Form'\n\n    // set default options\n    const defaultOptions = {\n      target: null,\n      resultName: 'uppyResult',\n      getMetaFromForm: true,\n      addResultToForm: true,\n      submitOnSuccess: false,\n      triggerUploadOnSubmit: false\n    }\n\n    // merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOptions, opts)\n\n    this.handleFormSubmit = this.handleFormSubmit.bind(this)\n    this.handleUploadStart = this.handleUploadStart.bind(this)\n    this.handleSuccess = this.handleSuccess.bind(this)\n    this.addResultToForm = this.addResultToForm.bind(this)\n    this.getMetaFromForm = this.getMetaFromForm.bind(this)\n  }\n\n  handleUploadStart () {\n    if (this.opts.getMetaFromForm) {\n      this.getMetaFromForm()\n    }\n  }\n\n  handleSuccess (result) {\n    if (this.opts.addResultToForm) {\n      this.addResultToForm(result)\n    }\n\n    if (this.opts.submitOnSuccess) {\n      this.form.submit()\n    }\n  }\n\n  handleFormSubmit (ev) {\n    if (this.opts.triggerUploadOnSubmit) {\n      ev.preventDefault()\n      this.uppy.upload()\n    }\n  }\n\n  addResultToForm (result) {\n    this.uppy.log('[Form] Adding result to the original form:')\n    this.uppy.log(result)\n\n    let resultInput = this.form.querySelector(`[name=\"${this.opts.resultName}\"]`)\n    if (resultInput) {\n      resultInput.value = JSON.stringify(result)\n      return\n    }\n\n    resultInput = document.createElement('input')\n    resultInput.name = this.opts.resultName\n    resultInput.type = 'hidden'\n    resultInput.value = JSON.stringify(result)\n    this.form.appendChild(resultInput)\n  }\n\n  getMetaFromForm () {\n    const formMeta = getFormData(this.form)\n    this.uppy.setMeta(formMeta)\n  }\n\n  install () {\n    this.form = findDOMElement(this.opts.target)\n    if (!this.form || !this.form.nodeName === 'FORM') {\n      console.error('Form plugin requires a <form> target element passed in options to operate, none was found', 'error')\n      return\n    }\n\n    this.form.addEventListener('submit', this.handleFormSubmit)\n    this.uppy.on('upload', this.handleUploadStart)\n    this.uppy.on('complete', this.handleSuccess)\n  }\n\n  uninstall () {\n    this.form.removeEventListener('submit', this.handleFormSubmit)\n    this.uppy.off('upload', this.handleUploadStart)\n    this.uppy.off('complete', this.handleSuccess)\n  }\n}\n"]}