<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>myApp documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">myApp documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>ModelLoaderProvider</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/providers/model-loader/model-loader.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>File Name:       model-loader.ts
Version Number:  v1.0
Author Name:     Tobias Bester
Project Name:    Ninshiki
Organization:    Software Sharks
Manual:  Refer to the Ninshiki User Manual at <a href="https://github.com/OrishaOrrie/SoftwareSharks/blob/master/Documentation/User%20Manual.pdf">https://github.com/OrishaOrrie/SoftwareSharks/blob/master/Documentation/User%20Manual.pdf</a></p>
<h2 id="update-history-">Update History:</h2>
<h2 id="date-author-description">Date         Author        Description</h2>
<h2 id="21-07-2018-tobias-created-provider">21/07/2018   Tobias        Created provider</h2>
<p>Functional Description:
  Handles all requests related to image classification and TensorFlow functions</p>

            </p>


            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#model">model</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#modelNumber">modelNumber</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#modelType">modelType</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#resultPreds">resultPreds</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#cropImage">cropImage</a>
                            </li>
                            <li>
                                <a href="#getResults">getResults</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#loadModel">loadModel</a>
                            </li>
                            <li>
                                <a href="#mapPredictions">mapPredictions</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#modelHasLinks">modelHasLinks</a>
                            </li>
                            <li>
                                <a href="#modelIsReady">modelIsReady</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#predictImage">predictImage</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#processResultNames">processResultNames</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#sortPreds">sortPreds</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(alertCtrl: AlertController)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="73" class="link-to-prism">src/providers/model-loader/model-loader.ts:73</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>alertCtrl</td>
                                                  
                                                        <td>
                                                                    <code>AlertController</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code><p>Controls the alert element</p>
</code>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="methods">
            Methods
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="cropImage"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            cropImage
                            </b>
                            <a href="#cropImage"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>cropImage(img: )</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="147" class="link-to-prism">src/providers/model-loader/model-loader.ts:147</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Called by the predictImage function, this crops the raw image pixel data to a smaller
size so that it can be resized later</p>
</div>

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>img</td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                        <td>
                                                                <code><p>The raw image pixel data as returned by tf.fromPixels</p>
</code>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                            </div>
                                <div class="io-description">
                                    <p>The raw pixel data of the cropped image</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getResults"></a>
                        <span class="name">
                            <b>
                            getResults
                            </b>
                            <a href="#getResults"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>getResults()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="159" class="link-to-prism">src/providers/model-loader/model-loader.ts:159</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>A getter for resultPreds. Also processes the prediction results by calling processResultNames()</p>
</div>

                            <div class="io-description">
                                <b>Returns : </b>    <code>{}</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="loadModel"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            loadModel
                            </b>
                            <a href="#loadModel"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>loadModel()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="86" class="link-to-prism">src/providers/model-loader/model-loader.ts:86</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Loads the TensorFlowJS model from the specified URL by using the tf.loadModel. It then warms up the model
by predicting on a blank image. This function only loads a model if one has not been loaded already</p>
</div>

                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="mapPredictions"></a>
                        <span class="name">
                            <b>
                            mapPredictions
                            </b>
                            <a href="#mapPredictions"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>mapPredictions(classPreds: )</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="171" class="link-to-prism">src/providers/model-loader/model-loader.ts:171</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Maps the predictions returned from the predictImage function to the corresponding class labels in
the classes JSON file. Then the classes are sorted by decreasing likeliness and the classes with a
likeliness lower than 0.001% are cut off</p>
</div>

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>classPreds</td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                        <td>
                                                                <code><p>tf.Tensor.data  The list of predictions returned by the predictImage function</p>
</code>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>{}</code>

                            </div>
                                <div class="io-description">
                                    <p>An array of JSON objects of the model classes and their associated prediction likeliness</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="modelHasLinks"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            modelHasLinks
                            </b>
                            <a href="#modelHasLinks"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>modelHasLinks()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="216" class="link-to-prism">src/providers/model-loader/model-loader.ts:216</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Checks whether the selected model contains catalogue links</p>
</div>

                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                            </div>
                                <div class="io-description">
                                    <p>True if the model has links, false if not</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="modelIsReady"></a>
                        <span class="name">
                            <b>
                            modelIsReady
                            </b>
                            <a href="#modelIsReady"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>modelIsReady()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="111" class="link-to-prism">src/providers/model-loader/model-loader.ts:111</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Checks if the model is ready to be used</p>
</div>

                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                            </div>
                                <div class="io-description">
                                    <p>True if a TensorFlowJS model is loaded into memory. False if not</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="predictImage"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            predictImage
                            </b>
                            <a href="#predictImage"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>predictImage(image: )</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="125" class="link-to-prism">src/providers/model-loader/model-loader.ts:125</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Performs a set of TensorFlowJS operations that result in a list of predicted classes of an image</p>
</div>

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>image</td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                        <td>
                                                                <code><p>HTMLImageElement containing the image to be predicted</p>
</code>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>{}</code>

                            </div>
                                <div class="io-description">
                                    <p>A list of predictions where each element is the predicted likeliness of the corresponding model class</p>

                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="processResultNames"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            processResultNames
                            </b>
                            <a href="#processResultNames"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>processResultNames()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="224" class="link-to-prism">src/providers/model-loader/model-loader.ts:224</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Formats the class labels to a more readable format and slices off classes with a likeliness lower
than 0.001%</p>
</div>

                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="sortPreds"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            sortPreds
                            </b>
                            <a href="#sortPreds"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>sortPreds()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="206" class="link-to-prism">src/providers/model-loader/model-loader.ts:206</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Called by mapPredictions in order to sort the classes by likeliness</p>
</div>

                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="model"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            model
                            </b>
                            <a href="#model"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>model:     <code>tf.Model</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>tf.Model</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>null</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="38" class="link-to-prism">src/providers/model-loader/model-loader.ts:38</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>Reference to the TensorFlowJS Model instance that is loaded into memory</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="modelNumber"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            modelNumber
                            </b>
                            <a href="#modelNumber"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>modelNumber:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>1</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="73" class="link-to-prism">src/providers/model-loader/model-loader.ts:73</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>Determines which modelType object is selected to specify which model should be used</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="modelType"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            modelType
                            </b>
                            <a href="#modelType"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>modelType:     <code>[]</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>[]</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>[{
    &#x27;name&#x27;: &#x27;bramhope&#x27;,
      &#x27;url&#x27;: &#x27;https://storage.googleapis.com/testproject-ee885.appspot.com/mobilenet_model/model.json&#x27;,
      &#x27;classJson&#x27;: &#x27;classes.json&#x27;,
      &#x27;numClasses&#x27;: 57,
      &#x27;hasLinks&#x27;: false
    },
    {
      &#x27;name&#x27;: &#x27;bramhope&#x27;,
      &#x27;url&#x27;: &#x27;https://storage.googleapis.com/testproject-ee885.appspot.com/bramhope_mobilenet_model/model.json&#x27;,
      &#x27;classJson&#x27;: &#x27;bramhope_classes.json&#x27;,
      &#x27;numClasses&#x27;: 53,
      &#x27;hasLinks&#x27;: true
    },
    {
      &#x27;name&#x27;: &#x27;imagenet&#x27;,
      &#x27;url&#x27;: &#x27;https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json&#x27;,
      &#x27;classJson&#x27;: &#x27;imagenet_classes.json&#x27;,
      &#x27;numClasses&#x27;: 1000,
      &#x27;hasLinks&#x27;: false
  }]</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="44" class="link-to-prism">src/providers/model-loader/model-loader.ts:44</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>Specifies the different models that can be used, including their name, the URL of the Google Storage bucket in which
they are called from, the number of classes that it can predict from, and whether the model has catalogue links, as is the
case with the Bramhope model. Also includes the classes JSON file with the model&#39;s corresponding class labels</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="resultPreds"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            resultPreds
                            </b>
                            <a href="#resultPreds"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>resultPreds:     <code>[]</code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>[]</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>[]</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="69" class="link-to-prism">src/providers/model-loader/model-loader.ts:69</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>An array used to store JSON objects related to the classes that were predicted. Includes class name, class likeliness,
and class catalogue links, if specified</p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { AlertController } from &#x27;ionic-angular&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;
import * as tf from &#x27;@tensorflow/tfjs&#x27;;
/**
 * @ignore
 */
declare var require: any

/**
 * File Name:       model-loader.ts
 * Version Number:  v1.0
 * Author Name:     Tobias Bester
 * Project Name:    Ninshiki
 * Organization:    Software Sharks
 * Manual:  Refer to the Ninshiki User Manual at https://github.com/OrishaOrrie/SoftwareSharks/blob/master/Documentation/User%20Manual.pdf
 * Update History:
 * ------------------------------------------
 * Date         Author        Description
 * ------------------------------------------
 * 21/07/2018   Tobias        Created provider
 * ------------------------------------------
 * Functional Description:
 *  Handles all requests related to image classification and TensorFlow functions
 */

/*
  Generated class for the ModelLoaderProvider provider.

  See https://angular.io/guide/dependency-injection for more info on providers
  and Angular DI.
*/
@Injectable()
export class ModelLoaderProvider {

  /**
   * Reference to the TensorFlowJS Model instance that is loaded into memory
   */
  private model: tf.Model &#x3D; null;
  /**
   * Specifies the different models that can be used, including their name, the URL of the Google Storage bucket in which
   * they are called from, the number of classes that it can predict from, and whether the model has catalogue links, as is the
   * case with the Bramhope model. Also includes the classes JSON file with the model&#x27;s corresponding class labels
   */
  public modelType &#x3D; [{
    &#x27;name&#x27;: &#x27;bramhope&#x27;,
      &#x27;url&#x27;: &#x27;https://storage.googleapis.com/testproject-ee885.appspot.com/mobilenet_model/model.json&#x27;,
      &#x27;classJson&#x27;: &#x27;classes.json&#x27;,
      &#x27;numClasses&#x27;: 57,
      &#x27;hasLinks&#x27;: false
    },
    {
      &#x27;name&#x27;: &#x27;bramhope&#x27;,
      &#x27;url&#x27;: &#x27;https://storage.googleapis.com/testproject-ee885.appspot.com/bramhope_mobilenet_model/model.json&#x27;,
      &#x27;classJson&#x27;: &#x27;bramhope_classes.json&#x27;,
      &#x27;numClasses&#x27;: 53,
      &#x27;hasLinks&#x27;: true
    },
    {
      &#x27;name&#x27;: &#x27;imagenet&#x27;,
      &#x27;url&#x27;: &#x27;https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json&#x27;,
      &#x27;classJson&#x27;: &#x27;imagenet_classes.json&#x27;,
      &#x27;numClasses&#x27;: 1000,
      &#x27;hasLinks&#x27;: false
  }];
  /**
   * An array used to store JSON objects related to the classes that were predicted. Includes class name, class likeliness,
   * and class catalogue links, if specified
   */
  public resultPreds &#x3D; [];
  /**
   * Determines which modelType object is selected to specify which model should be used
   */
  public modelNumber &#x3D; 1;

  /**
   * 
   * @param http Provides the service to handle HTTP requests
   * @param alertCtrl Controls the alert element
   */
  constructor(private alertCtrl: AlertController) { }

  /**
   * Loads the TensorFlowJS model from the specified URL by using the tf.loadModel. It then warms up the model
   * by predicting on a blank image. This function only loads a model if one has not been loaded already
   */
  async loadModel() {
    if (this.modelIsReady()) {
      console.log(&#x27;Model is already loaded&#x27;);
    } else {
      try {
        this.model &#x3D; await tf.loadModel(this.modelType[this.modelNumber].url);
        (this.model.predict(tf.zeros([1, 224, 224, 3])) as tf.Tensor&lt;tf.Rank&gt;).dispose();
        console.log(&#x27;Provider: Model is Loaded!&#x27;);
        //this.modelStatus &#x3D; &#x27;Model loaded YAS QUEEN&#x27;;
      } catch (err) {
        // Handle error
        let prompt &#x3D; this.alertCtrl.create({
          title: &#x27;Error loading model&#x27;,
          subTitle: err,
          buttons: [&#x27;OK&#x27;]
        });
        prompt.present();
      }
    }
  };

  /**
   * Checks if the model is ready to be used
   * @returns   True if a TensorFlowJS model is loaded into memory. False if not
   */
  modelIsReady() {
    // console.log(&#x27;Checking modelIsReady&#x27;);
    if (this.model &#x3D;&#x3D; null) {
      return false;
    } else {
      return true;
    }
  }

  /**
   * Performs a set of TensorFlowJS operations that result in a list of predicted classes of an image
   * @param image   HTMLImageElement containing the image to be predicted
   * @returns   A list of predictions where each element is the predicted likeliness of the corresponding model class
   */
  async predictImage(image) {
    const predictedClass &#x3D; tf.tidy(() &#x3D;&gt; {
      const raw &#x3D; tf.fromPixels(image, 3);
      const cropped &#x3D; this.cropImage(raw);
      // 224,224 is the required size for the MobileNet model
      const resized &#x3D; tf.image.resizeBilinear(cropped, [224, 224]);
      const batchedImage &#x3D; resized.expandDims(0);
      const img &#x3D; batchedImage.toFloat().div(tf.scalar(127)).sub(tf.scalar(1));
      const predictions &#x3D; (this.model.predict(img) as tf.Tensor);
      return predictions;
    });

    const classId &#x3D; (await predictedClass.data());
    return classId;
  }

  /**
   * Called by the predictImage function, this crops the raw image pixel data to a smaller
   * size so that it can be resized later
   * @param img   The raw image pixel data as returned by tf.fromPixels
   * @returns   The raw pixel data of the cropped image
   */
  private cropImage(img) {
    const size &#x3D; Math.min(img.shape[0], img.shape[1]);
    const centerHeight &#x3D; img.shape[0] / 2;
    const beginHeight &#x3D; centerHeight - (size / 2);
    const centerWidth &#x3D; img.shape[1] / 2;
    const beginWidth &#x3D; centerWidth - (size / 2);
    return img.slice([beginHeight, beginWidth, 0], [size, size, 3]);
  };

  /**
   * A getter for resultPreds. Also processes the prediction results by calling processResultNames()
   */
  getResults() {
    this.processResultNames();
    return this.resultPreds;
  };

  /**
   * Maps the predictions returned from the predictImage function to the corresponding class labels in
   * the classes JSON file. Then the classes are sorted by decreasing likeliness and the classes with a
   * likeliness lower than 0.001% are cut off
   * @param classPreds  tf.Tensor.data  The list of predictions returned by the predictImage function
   * @returns   An array of JSON objects of the model classes and their associated prediction likeliness
   */
  mapPredictions(classPreds) {
    console.log(&#x27;Mapping predictions...&#x27;);
    const classesJson &#x3D; require(&#x60;./classes/${this.modelType[this.modelNumber].classJson}&#x60;);
    const numClasses &#x3D; classPreds.length;
    this.resultPreds &#x3D; [];
    const linkExists &#x3D; this.modelHasLinks();

    for (let i &#x3D; 0; i &lt; numClasses; i++) {
      // tslint:disable-next-line:triple-equals
      if (this.modelNumber &#x3D;&#x3D; 2) {
        // Use if the classes json is in the plain format
        this.resultPreds[i] &#x3D; {};
        this.resultPreds[i].name &#x3D; classesJson[i];
        this.resultPreds[i].likeliness &#x3D; (classPreds[i] * 100).toFixed(4);
      } else {
        // Used if the classes json is in the custom format
        this.resultPreds[i] &#x3D; {};
        this.resultPreds[i].id &#x3D; classesJson.classes[i].id;
        this.resultPreds[i].first &#x3D; classesJson.classes[i].first;
        this.resultPreds[i].name &#x3D; classesJson.classes[i].name;
        this.resultPreds[i].likeliness &#x3D; (classPreds[i] * 100).toFixed(4);
        if (linkExists) {
          this.resultPreds[i].link &#x3D; classesJson.classes[i].link;
        }
      }
    }

    this.sortPreds();
    this.processResultNames();
    return this.resultPreds;
  }

  /**
   * Called by mapPredictions in order to sort the classes by likeliness
  */
  private sortPreds() {
    this.resultPreds.sort((a, b) &#x3D;&gt; {
      return b.likeliness - a.likeliness;
    });
  }

  /**
   * Checks whether the selected model contains catalogue links
   * @returns   True if the model has links, false if not
   */
  private modelHasLinks() {
    return this.modelType[this.modelNumber].hasLinks;
  }

  /**
   * Formats the class labels to a more readable format and slices off classes with a likeliness lower
   * than 0.001%
   */
  private processResultNames() {
    this.resultPreds.forEach((element, index) &#x3D;&gt; {
      element.name &#x3D; element.name.replace(/_/g, &#x27; &#x27;);
      element.name &#x3D; element.name.charAt(0).toUpperCase() + element.name.slice(1);

      if (element.likeliness &lt; 0.001) {
        this.resultPreds &#x3D; this.resultPreds.slice(0, index);
      }
    });
  }

}
</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ModelLoaderProvider.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <script src="../js/menu-wc.js"></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
